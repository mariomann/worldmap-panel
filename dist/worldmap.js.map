{"version":3,"sources":["../src/worldmap.js"],"names":["_","L","tileServers","url","attribution","subdomains","WorldMap","ctrl","mapContainer","circles","createMap","mapCenter","window","latLng","parseFloat","panel","mapCenterLatitude","mapCenterLongitude","map","worldCopyJump","center","zoom","parseInt","initialZoom","setMouseWheelZoom","selectedTileServer","tileServer","tileLayer","maxZoom","reuseTiles","detectRetina","addTo","legend","control","position","onAdd","_div","DomUtil","create","update","thresholds","data","legendHtml","colors","index","length","innerHTML","locations","sort","dataPoints","isEqual","filter","o","hideEmpty","isNil","value","hideZero","circlesLayer","clearLayers","removeCircles","filterEmptyAndZeroValues","needToRedrawCircles","clearCircles","createCircles","updateCircles","forEach","dataPoint","locationName","push","createCircle","addCircles","circle","find","cir","options","location","key","isAp","updateApCircle","setRadius","calcCircleSize","setStyle","color","getColor","fillColor","fillOpacity","unbindPopup","createPopup","valueRounded","unbindTooltip","text","totalProbes","failingProbes","bindTooltip","permanent","direction","createApCircle","circleMarker","locationLatitude","locationLongitude","radius","successRate","createApPopup","createApTooltip","unit","unitSingular","unitPlural","label","failingProbesNames","join","trim","bindPopup","point","stickyLabels","on","onMouseOver","evt","layer","target","bringToFront","openPopup","onMouseOut","closePopup","dataPointValue","circleMinSize","circleMaxSize","valueRange","dataFactor","lowestValue","circleSizeRange","first","invalidateSize","panTo","mapCenterMoved","remove","mouseWheelZoom","scrollWheelZoom","disable","enable","layerGroup","removeLayer","zoomFactor","setZoom","removeLegend"],"mappings":"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","file":"worldmap.js","sourcesContent":["import _ from 'lodash';\n/* eslint-disable id-length, no-unused-vars */\nimport L from './libs/leaflet';\n/* eslint-disable id-length, no-unused-vars */\n\nconst tileServers = {\n  'CartoDB Positron': { url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>', subdomains: 'abcd' },\n  'CartoDB Dark': { url: 'https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png', attribution: '&copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> &copy; <a href=\"http://cartodb.com/attributions\">CartoDB</a>', subdomains: 'abcd' }\n};\n\n/**\nwindow.L.CircleMarker.include({\n  bindLabel: function (content, options) {\n      if (!this._label || this._label.options !== options) {\n          this._label = new window.L.Label(options, this);\n      }\n\n      this._label.setContent(content);\n      this._labelNoHide = options && options.noHide;\n\n      if (!this._showLabelAdded) {\n          if (this._labelNoHide) {\n              this\n                  .on('remove', this.hideLabel, this)\n                  .on('move', this._moveLabel, this);\n              this._showLabel({latlng: this.getLatLng()});\n          } else {\n              this\n                  .on('mouseover', this._showLabel, this)\n                  .on('mousemove', this._moveLabel, this)\n                  .on('mouseout remove', this._hideLabel, this);\n              if (window.L.Browser.touch) {\n                  this.on('click', this._showLabel, this);\n              }\n          }\n          this._showLabelAdded = true;\n      }\n\n      return this;\n  },\n\n  unbindLabel: function () {\n      if (this._label) {\n          this._hideLabel();\n          this._label = null;\n          this._showLabelAdded = false;\n          if (this._labelNoHide) {\n              this\n                  .off('remove', this._hideLabel, this)\n                  .off('move', this._moveLabel, this);\n          } else {\n              this\n                  .off('mouseover', this._showLabel, this)\n                  .off('mousemove', this._moveLabel, this)\n                  .off('mouseout remove', this._hideLabel, this);\n          }\n      }\n      return this;\n  }\n});\n*/\nexport default class WorldMap {\n  constructor(ctrl, mapContainer) {\n    this.ctrl = ctrl;\n    this.mapContainer = mapContainer;\n    this.circles = [];\n\n    return this.createMap();\n  }\n\n  createMap() {\n    const mapCenter = window.L.latLng(parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude));\n    this.map = window.L.map(this.mapContainer, { worldCopyJump: true, center: mapCenter, zoom: parseInt(this.ctrl.panel.initialZoom, 10) || 1 });\n    this.setMouseWheelZoom();\n\n    const selectedTileServer = tileServers[this.ctrl.tileServer];\n    window.L.tileLayer(selectedTileServer.url, {\n      maxZoom: 18,\n      subdomains: selectedTileServer.subdomains,\n      reuseTiles: true,\n      detectRetina: true,\n      attribution: selectedTileServer.attribution\n    }).addTo(this.map);\n  }\n\n  createLegend() {\n    this.legend = window.L.control({ position: 'bottomleft' });\n    this.legend.onAdd = () => {\n      this.legend._div = window.L.DomUtil.create('div', 'info legend');\n      this.legend.update();\n      return this.legend._div;\n    };\n\n    this.legend.update = () => {\n      const thresholds = this.ctrl.data.thresholds;\n      let legendHtml = '';\n      legendHtml += '<div class=\"legend-item\"><i style=\"background:' + this.ctrl.panel.colors[0] + '\"></i> ' +\n        '&lt; ' + thresholds[0] + '</div>';\n      for (let index = 0; index < thresholds.length; index += 1) {\n        legendHtml +=\n          '<div class=\"legend-item\"><i style=\"background:' + this.ctrl.panel.colors[index + 1] + '\"></i> ' +\n          thresholds[index] + (thresholds[index + 1] ? '&ndash;' + thresholds[index + 1] + '</div>' : '+');\n      }\n      this.legend._div.innerHTML = legendHtml;\n    };\n    this.legend.addTo(this.map);\n  }\n\n  needToRedrawCircles(data) {\n    if (this.circles.length === 0 && data.length > 0) return true;\n\n    if (this.circles.length !== data.length) return true;\n    const locations = _.map(_.map(this.circles, 'options'), 'location').sort();\n    const dataPoints = _.map(data, 'key').sort();\n    return !_.isEqual(locations, dataPoints);\n  }\n\n  filterEmptyAndZeroValues(data) {\n    return _.filter(data, (o) => { return !(this.ctrl.panel.hideEmpty && _.isNil(o.value)) && !(this.ctrl.panel.hideZero && o.value === 0); });\n  }\n\n  clearCircles() {\n    if (this.circlesLayer) {\n      this.circlesLayer.clearLayers();\n      this.removeCircles(this.circlesLayer);\n      this.circles = [];\n    }\n  }\n\n  drawCircles() {\n    const data = this.filterEmptyAndZeroValues(this.ctrl.data);\n    if (this.needToRedrawCircles(data)) {\n      this.clearCircles();\n      this.createCircles(data);\n    } else {\n      this.updateCircles(data);\n    }\n  }\n\n  createCircles(data) {\n    const circles = [];\n    data.forEach((dataPoint) => {\n      if (!dataPoint.locationName) return;\n      circles.push(this.createCircle(dataPoint));\n    });\n    this.circlesLayer = this.addCircles(circles);\n    this.circles = circles;\n  }\n\n  updateCircles(data) {\n    data.forEach((dataPoint) => {\n      if (!dataPoint.locationName) return;\n\n      const circle = _.find(this.circles, (cir) => { return cir.options.location === dataPoint.key; });\n\n      if (circle && dataPoint.isAp) {\n        this.updateApCircle(circle, dataPoint);\n      } else if (circle) {\n        circle.setRadius(this.calcCircleSize(dataPoint.value || 0));\n        circle.setStyle({\n          color: this.getColor(dataPoint.value),\n          fillColor: this.getColor(dataPoint.value),\n          fillOpacity: 0.5,\n          location: dataPoint.key,\n        });\n        circle.unbindPopup();\n        this.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\n\n        //TODO to function\n        circle.unbindTooltip();\n        const text = (dataPoint.totalProbes - dataPoint.failingProbes) + \"/\" + dataPoint.totalProbes;\n        circle.bindTooltip(text, {\n          permanent: true,\n          direction: 'center'\n        });\n      }\n    });\n  }\n\n  createCircle(dataPoint) {\n    if (dataPoint.isAp) {\n      return this.createApCircle(dataPoint);\n    }\n\n    const circle = window.L.circleMarker([dataPoint.locationLatitude, dataPoint.locationLongitude], {\n      radius: this.calcCircleSize(dataPoint.value || 0),\n      color: this.getColor(dataPoint.value),\n      fillColor: this.getColor(dataPoint.value),\n      fillOpacity: 0.5,\n      location: dataPoint.key\n    });\n\n    this.createPopup(circle, dataPoint.locationName, dataPoint.valueRounded);\n    return circle;\n  }\n\n  updateApCircle(circle, dataPoint) {\n    circle.setRadius(this.calcCircleSize(dataPoint.value || 0));\n    circle.setStyle({\n      color: this.getColor(dataPoint.successRate),\n      fillColor: this.getColor(dataPoint.successRate),\n      fillOpacity: 0.5,\n      location: dataPoint.key,\n    });\n    circle.unbindPopup();\n    this.createApPopup(circle, dataPoint);\n\n    circle.unbindTooltip();\n    this.createApTooltip(circle, dataPoint);\n  }\n\n  createApCircle(dataPoint) {\n    const circle = window.L.circleMarker([dataPoint.locationLatitude, dataPoint.locationLongitude], {\n      radius: this.calcCircleSize(dataPoint.value || 0),\n      color: this.getColor(dataPoint.successRate),\n      fillColor: this.getColor(dataPoint.successRate),\n      fillOpacity: 0.5,\n      location: dataPoint.key\n    });\n\n    this.createApTooltip(circle, dataPoint);\n    this.createApPopup(circle, dataPoint);\n    return circle;\n  }\n\n  createApTooltip(circle, dataPoint) {\n    //const text = dataPoint.failingProbes + \"/\" + dataPoint.totalProbes;\n    let text;\n    if (dataPoint.failingProbes <= 0) {\n      text = `<div class=\"ap-larger\"><b>${dataPoint.totalProbes}</b></div>`;\n    } else {\n      text = `\n        <div class=\"ap-larger\" style=\"margin-top: 20px;\"><b>${dataPoint.totalProbes}</b></div>\n        <div class=\"ap-meter\">\n            <span class=\"ap-meter-span\" style=\"width: ${100 - dataPoint.successRate}%\"></span>\n            <div class=\"ap-meter-label\"><b>${dataPoint.failingProbes}</b></div>\n        </div>\n      `;\n    }\n\n    circle.bindTooltip(text, {\n      permanent: true,\n      direction: 'center'\n    });\n  }\n\n  createApPopup(circle, dataPoint) {\n    const locationName = dataPoint.locationName;\n    const value = dataPoint.valueRounded;\n    const unit = value && value === 1 ? this.ctrl.panel.unitSingular : this.ctrl.panel.unitPlural;\n    //const label = (locationName + ': ' + value + ' ' + (unit || '')).trim();\n    let label = `\n      <h4>[AP] ${locationName}</h4>\n      <ul>\n        <li>Success rate: ${dataPoint.successRate}%</li>\n        <li>Total probes: ${dataPoint.totalProbes}</li>\n        <li>Failing probes: ${dataPoint.failingProbes}</li>\n        <li>Failing probes name(s): ${dataPoint.failingProbesNames ? \"<br/>\\t\\t- \" + dataPoint.failingProbesNames.join(\"<br/>\\t\\t- \") : \"-\"}</li>\n      </ul>\n    `.trim();\n\n    circle.bindPopup(label, { 'offset': window.L.point(0, -2), 'className': 'worldmap-popup', 'closeButton': this.ctrl.panel.stickyLabels });\n\n    circle.on('mouseover', function onMouseOver(evt) {\n      const layer = evt.target;\n      layer.bringToFront();\n      this.openPopup();\n    });\n\n    if (!this.ctrl.panel.stickyLabels) {\n      circle.on('mouseout', function onMouseOut() {\n        circle.closePopup();\n      });\n    }\n  }\n\n  calcCircleSize(dataPointValue) {\n    const circleMinSize = parseInt(this.ctrl.panel.circleMinSize, 10) || 2;\n    const circleMaxSize = parseInt(this.ctrl.panel.circleMaxSize, 10) || 30;\n\n    if (this.ctrl.data.valueRange === 0) {\n      return circleMaxSize;\n    }\n\n    const dataFactor = (dataPointValue - this.ctrl.data.lowestValue) / this.ctrl.data.valueRange;\n    const circleSizeRange = circleMaxSize - circleMinSize;\n\n    return (circleSizeRange * dataFactor) + circleMinSize;\n  }\n\n  createPopup(circle, locationName, value) {\n    const unit = value && value === 1 ? this.ctrl.panel.unitSingular : this.ctrl.panel.unitPlural;\n    const label = (locationName + ': ' + value + ' ' + (unit || '')).trim();\n    circle.bindPopup(label, { 'offset': window.L.point(0, -2), 'className': 'worldmap-popup', 'closeButton': this.ctrl.panel.stickyLabels });\n\n    circle.on('mouseover', function onMouseOver(evt) {\n      const layer = evt.target;\n      layer.bringToFront();\n      this.openPopup();\n    });\n\n    if (!this.ctrl.panel.stickyLabels) {\n      circle.on('mouseout', function onMouseOut() {\n        circle.closePopup();\n      });\n    }\n  }\n\n  getColor(value) {\n    for (let index = this.ctrl.data.thresholds.length; index > 0; index -= 1) {\n      if (value >= this.ctrl.data.thresholds[index - 1]) {\n        return this.ctrl.panel.colors[index];\n      }\n    }\n    return _.first(this.ctrl.panel.colors);\n  }\n\n  resize() {\n    this.map.invalidateSize();\n  }\n\n  panToMapCenter() {\n    this.map.panTo([parseFloat(this.ctrl.panel.mapCenterLatitude), parseFloat(this.ctrl.panel.mapCenterLongitude)]);\n    this.ctrl.mapCenterMoved = false;\n  }\n\n  removeLegend() {\n    this.legend.remove(this.map);\n    this.legend = null;\n  }\n\n  setMouseWheelZoom() {\n    if (!this.ctrl.panel.mouseWheelZoom) {\n      this.map.scrollWheelZoom.disable();\n    } else {\n      this.map.scrollWheelZoom.enable();\n    }\n  }\n\n  addCircles(circles) {\n    return window.L.layerGroup(circles).addTo(this.map);\n  }\n\n  removeCircles() {\n    this.map.removeLayer(this.circlesLayer);\n  }\n\n  setZoom(zoomFactor) {\n    this.map.setZoom(parseInt(zoomFactor, 10));\n  }\n\n  remove() {\n    this.circles = [];\n    if (this.circlesLayer) this.removeCircles();\n    if (this.legend) this.removeLegend();\n    this.map.remove();\n  }\n}\n"]}